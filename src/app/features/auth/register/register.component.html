<div class="registrar-container">
  <div class="registrar-card">
    <!-- Header com Logo -->
    <div class="registrar-header">
      <div class="logo">
        <img src="assets/images/logo/logo5.png" alt="ALLTURISMO" class="logo-image">
        <span class="logo-text">ALLTURISMO</span>
      </div>
      <div class="header-content">
        <h3 class="subtitle">SEJA UM PARCEIRO</h3>
        <h2 class="title">{{ stepTitle }}</h2>
      </div>
    </div>

    <!-- Barra de Progresso -->
    <div class="progress-bar">
      <div class="progress-step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
        <div class="step-number">
          <span *ngIf="currentStep > 1" class="check-icon">✓</span>
          <span *ngIf="currentStep === 1">1</span>
        </div>
        <span class="step-text">Responsável</span>
      </div>
      <div class="progress-line" [class.completed]="currentStep > 1"></div>
      <div class="progress-step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
        <div class="step-number">
          <span *ngIf="currentStep > 2" class="check-icon">✓</span>
          <span *ngIf="currentStep <= 2">2</span>
        </div>
        <span class="step-text">Endereço</span>
      </div>
      <div class="progress-line" [class.completed]="currentStep > 2"></div>
      <div class="progress-step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
        <div class="step-number">
          <span *ngIf="currentStep > 3" class="check-icon">✓</span>
          <span *ngIf="currentStep <= 3">3</span>
        </div>
        <span class="step-text">Estabelecimento</span>
      </div>
    </div>

    <!-- Formulário -->
    <form (ngSubmit)="nextStep()" class="registrar-form">
      
      <!-- Etapa 1: Dados do Responsável -->
      <div *ngIf="isStep1" class="form-step">
        <div class="form-group">
          <label for="name">Nome</label>
          <input 
            type="text" 
            id="name" 
            name="name" 
            [(ngModel)]="name" 
            placeholder="Digite seu nome completo"
            required
          >
        </div>

        <div class="form-group">
          <label for="email">E-mail</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            [(ngModel)]="email" 
            placeholder="Digite seu e-mail"
            required
          >
        </div>

                 <div class="form-group">
           <label for="phone">WhatsApp</label>
           <input 
             type="tel" 
             id="phone" 
             name="phone" 
             [(ngModel)]="phone" 
             (input)="formatPhone($event)"
             (keypress)="validateNumbersOnly($event)"
             placeholder="(XX) XXXXX-XXXX"
             maxlength="15"
             required
           >
         </div>
      </div>

      <!-- Etapa 2: Endereço -->
      <div *ngIf="isStep2" class="form-step">
                 <div class="form-group">
           <label for="cep">CEP</label>
           <input 
             type="text" 
             id="cep" 
             name="cep" 
             [(ngModel)]="cep" 
             (input)="formatCep($event)"
             (keypress)="validateNumbersOnly($event)"
             placeholder="00000-000"
             maxlength="9"
             required
           >
         </div>

        <div class="form-row">
          <div class="form-group">
            <label for="state">Estado</label>
            <input 
              type="text" 
              id="state" 
              name="state" 
              [(ngModel)]="state" 
              placeholder="Digite o estado"
              required
            >
          </div>

          <div class="form-group">
            <label for="city">Cidade</label>
            <input 
              type="text" 
              id="city" 
              name="city" 
              [(ngModel)]="city" 
              placeholder="Digite a cidade"
              required
            >
          </div>
        </div>

        <div class="form-group">
          <label for="neighborhood">Bairro</label>
          <input 
            type="text" 
            id="neighborhood" 
            name="neighborhood" 
            [(ngModel)]="neighborhood" 
            placeholder="Digite o bairro"
            required
          >
        </div>

        <div class="form-group">
          <label for="street">Rua/Avenida</label>
          <input 
            type="text" 
            id="street" 
            name="street" 
            [(ngModel)]="street" 
            placeholder="Digite a rua ou avenida"
            required
          >
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="number">Número</label>
            <input 
              type="text" 
              id="number" 
              name="number" 
              [(ngModel)]="number" 
              placeholder="Digite o número"
              required
            >
          </div>

          <div class="form-group">
            <label for="complement">Complemento (opcional)</label>
            <input 
              type="text" 
              id="complement" 
              name="complement" 
              [(ngModel)]="complement" 
              placeholder="Digite o complemento"
            >
          </div>
        </div>
      </div>

      <!-- Etapa 3: Estabelecimento -->
      <div *ngIf="isStep3" class="form-step">
        <div class="form-group">
          <label for="establishmentName">Nome do estabelecimento (como aparecerá no app)</label>
          <input 
            type="text" 
            id="establishmentName" 
            name="establishmentName" 
            [(ngModel)]="establishmentName" 
            placeholder="Ex.: Pizzaria Bela Massas"
            required
          >
        </div>

                 <div class="form-group">
           <label for="cnpj">CNPJ</label>
           <input 
             type="text" 
             id="cnpj" 
             name="cnpj" 
             [(ngModel)]="cnpj" 
             (input)="formatCnpj($event)"
             (keypress)="validateNumbersOnly($event)"
             placeholder="00.000.000/0001-00"
             maxlength="18"
             required
           >
         </div>

        <div class="form-group">
          <label class="section-title">Categoria</label>
          <p class="section-subtitle">Escolha a categoria que mais define seu estabelecimento:</p>
          
          <div class="category-grid">
            <div 
              *ngFor="let category of categories" 
              class="category-option"
              [class.selected]="categoryId === category.id"
              (click)="categoryId = category.id; subcategoryId = ''"
            >
              <input 
                type="radio" 
                [id]="'category-' + category.id"
                name="category" 
                [value]="category.id"
                [(ngModel)]="categoryId"
              >
              <label [for]="'category-' + category.id">{{ category.name }}</label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="subcategory">Subcategoria</label>
          <select 
            id="subcategory" 
            name="subcategory" 
            [(ngModel)]="subcategoryId"
            [disabled]="!categoryId"
          >
            <option value="">Selecione uma subcategoria</option>
            <option 
              *ngFor="let subcategory of getFilteredSubcategories()" 
              [value]="subcategory.id"
            >
              {{ subcategory.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="section-title">Meios de contato</label>
          <p class="section-subtitle">Ficarão visíveis em seu perfil no app.</p>
          
                     <div class="form-group">
             <label for="establishmentPhone">Telefone/WhatsApp</label>
             <input 
               type="tel" 
               id="establishmentPhone" 
               name="establishmentPhone" 
               [(ngModel)]="establishmentPhone" 
               (input)="formatEstablishmentPhone($event)"
               (keypress)="validateNumbersOnly($event)"
               placeholder="(XX) XXXXX-XXXX"
               maxlength="15"
               required
             >
           </div>

          <div class="form-group">
            <label for="instagram">Instagram</label>
            <input 
              type="url" 
              id="instagram" 
              name="instagram" 
              [(ngModel)]="instagram" 
              placeholder="Insira o link do seu perfil"
            >
          </div>
        </div>

        <div class="form-group">
          <label for="description">Descreva a atividade do estabelecimento</label>
          <textarea 
            id="description" 
            name="description" 
            [(ngModel)]="description" 
            placeholder="Ex.: Bar especializado em petiscos."
            maxlength="100"
            rows="4"
          ></textarea>
          <div class="char-counter">{{ description.length }}/100</div>
        </div>

        <div class="form-group">
          <label class="section-title">Logo (Opcional)</label>
          <p class="section-subtitle">Envie a logo do seu estabelecimento.</p>
          
                     <div class="logo-upload-area">
             <div class="upload-placeholder">
               <input 
                 type="file" 
                 id="logoFile" 
                 name="logoFile" 
                 accept="image/*"
                 (change)="onLogoSelected($event)"
                 style="display: none;"
                 #fileInput
               >
               <div class="upload-icon">↑</div>
               <button 
                 type="button" 
                 class="upload-btn" 
                 (click)="fileInput.click()"
               >
                 Selecionar imagem
               </button>
             </div>
             
             <div *ngIf="logoPreview" class="logo-preview">
               <img [src]="logoPreview" alt="Logo preview" class="preview-image">
               <button 
                 type="button" 
                 class="remove-btn" 
                 (click)="removeLogo()"
               >
                 Remover
               </button>
             </div>
           </div>
        </div>
      </div>

      <!-- Botões de Navegação -->
      <div class="form-actions">
        <a href="#" (click)="previousStep(); $event.preventDefault()" class="btn-back">
          Voltar
        </a>
        <button 
          type="submit" 
          class="btn-continue" 
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">{{ buttonText }}</span>
          <span *ngIf="isLoading">Carregando...</span>
        </button>
      </div>
    </form>
  </div>
</div>
