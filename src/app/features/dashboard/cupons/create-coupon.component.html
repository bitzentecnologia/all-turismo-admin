<div class="create-coupon-page">
  <header class="page-header">
    <h1>Criar novo cupom</h1>
  </header>

  <form #couponForm="ngForm" (ngSubmit)="onSubmit()" class="coupon-form">
    <!-- Description -->
    <section class="form-section">
      <label for="description" class="form-label">Descrição</label>
      <div class="textarea-wrapper">
        <textarea
          id="description"
          name="description"
          class="form-textarea"
          [(ngModel)]="description"
          placeholder="Ex.: Na compra de uma pizza grande, ganhe outra pequena de sobremesa."
          [maxlength]="maxDescriptionLength"
          required
          rows="3"
        ></textarea>
        <div class="char-counter">{{ descriptionCharCount }}/{{ maxDescriptionLength }}</div>
      </div>
    </section>

    <!-- Daily Quantity -->
    <section class="form-section">
      <label for="dailyQuantity" class="form-label">Quantidade diária ofertada</label>
      <input
        type="number"
        id="dailyQuantity"
        name="dailyQuantity"
        class="form-input"
        [(ngModel)]="dailyQuantity"
        placeholder="Ex.: 10"
        required
        min="1"
      />
    </section>

    <!-- Rules Section -->
    <section class="form-section">
      <div class="section-header">
        <label for="rules" class="form-label">Regras</label>
        <a href="javascript:void(0)" class="view-example-link" (click)="showExampleRules()">
          <mat-icon>visibility</mat-icon>
          Ver exemplo
        </a>
      </div>
      <div class="textarea-wrapper">
        <textarea
          id="rules"
          name="rules"
          class="form-textarea"
          [(ngModel)]="rules"
          placeholder="Escreva todas as regras para a utilização desse cupom"
          [maxlength]="maxRulesLength"
          required
          rows="5"
        ></textarea>
        <div class="char-counter">{{ rulesCharCount }}/{{ maxRulesLength }}</div>
      </div>
    </section>

    <!-- Product Photos -->
    <section class="form-section">
      <h3 class="section-title">Fotos do produto</h3>
      <p class="section-subtitle">
        Envie até 3 fotos do produto que receberá o desconto. Caso a promoção seja para todos os
        itens do estabelecimento, você pode enviar foto de alguns de seus produtos.
      </p>

      <div class="image-upload-wrapper">
        <div *ngIf="imagePreviewUrls.length < 3" class="upload-box">
          <input
            type="file"
            #fileInput
            accept="image/png,image/jpeg,image/jpg"
            multiple
            (change)="onImageSelect($event)"
            class="file-input"
            id="imageUpload"
          />
          <label for="imageUpload" class="upload-label">
            <mat-icon>file_upload</mat-icon>
            <span>Selecionar imagem</span>
          </label>
        </div>

        <div *ngIf="imagePreviewUrls.length > 0" class="image-preview-grid">
          <div *ngFor="let url of imagePreviewUrls; let i = index" class="image-preview-item">
            <img [src]="url" alt="Preview" class="preview-image" />
            <button type="button" class="remove-image-button" (click)="removeImage(i)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>

      <p class="help-text">Tamanho sugerido: x px x x px / Formato sugerido: PNG, JPG ou JPEG</p>
    </section>

    <!-- Period Section -->
    <section class="form-section">
      <h3 class="section-title">Período</h3>
      <p class="section-subtitle">Defina por quanto tempo o cupom ficará disponível.</p>

      <div class="date-range-wrapper">
        <div class="date-input-group">
          <label for="startDate" class="form-label">Início</label>
          <p-datepicker
            inputId="startDate"
            name="startDate"
            [(ngModel)]="startDate"
            dateFormat="dd/mm/yy"
            placeholder="Selecione uma data"
            [showIcon]="true"
            [iconDisplay]="'input'"
            [required]="true"
            styleClass="custom-calendar"
          />
        </div>

        <div class="date-input-group">
          <label for="endDate" class="form-label">Final</label>
          <p-datepicker
            inputId="endDate"
            name="endDate"
            [(ngModel)]="endDate"
            dateFormat="dd/mm/yy"
            placeholder="Selecione uma data"
            [showIcon]="true"
            [iconDisplay]="'input'"
            [required]="true"
            styleClass="custom-calendar"
          />
        </div>
      </div>
    </section>

    <!-- Time Section -->
    <section class="form-section">
      <h3 class="section-title">Horário de utilização</h3>
      <p class="section-subtitle">
        Defina em quais horários do dia o cupom poderá ser utilizado pelo cliente.
      </p>

      <div class="time-range-wrapper">
        <div class="time-input-group">
          <label for="startTime" class="form-label">De</label>
          <p-datepicker
            inputId="startTime"
            name="startTime"
            [(ngModel)]="startTime"
            [timeOnly]="true"
            [showIcon]="true"
            [iconDisplay]="'input'"
            placeholder="Selecione uma hora"
            [required]="true"
            styleClass="custom-calendar"
          />
        </div>

        <div class="time-input-group">
          <label for="endTime" class="form-label">Até</label>
          <p-datepicker
            inputId="calendar-timeonly"
            name="endTime"
            [(ngModel)]="endTime"
            [timeOnly]="true"
            [showIcon]="true"
            [iconDisplay]="'input'"
            placeholder="Selecione uma hora"
            [required]="true"
            styleClass="custom-calendar"
          />
        </div>
      </div>
    </section>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" class="cancel-button" (click)="onCancel()">Cancelar</button>
      <button type="submit" class="submit-button" [disabled]="!couponForm.valid">
        Criar cupom
      </button>
    </div>
  </form>

  <app-coupon-success-modal
    [(visible)]="showSuccessModal"
    (closed)="onModalClosed()"
    (viewRequests)="onViewRequests()"
  />
</div>
